<!-- _includes/slideshow.html -->
<section id="slideshow" aria-label="Chapter photo slideshow">
  <div class="slideshow-container">

    {% comment %}
      Pull all files from /img/photos, then gather jpg/jpeg/png separately and concat.
      Works on GitHub Pages (Jekyll 3.x).
    {% endcomment %}
    {% assign photos_all = site.static_files | where_exp: 'f', "f.path contains '/img/photos/'" %}
    {% assign jpgs  = photos_all | where: 'extname', '.jpg'  %}
    {% assign jpegs = photos_all | where: 'extname', '.jpeg' %}
    {% assign pngs  = photos_all | where: 'extname', '.png'  %}
    {% assign photos = jpgs | concat: jpegs | concat: pngs | sort: 'name' %}

    {% for f in photos %}
      <div class="slides fade" {% unless forloop.first %}style="display:none"{% endunless %}>
        <img src="{{ f.path | relative_url }}" alt="Chapter photo {{ forloop.index }}" style="width:100%">
      </div>
    {% endfor %}

    <button class="prev" type="button" aria-label="Previous slide" onclick="plusSlides(-1)">&#10094;</button>
    <button class="next" type="button" aria-label="Next slide" onclick="plusSlides(1)">&#10095;</button>
  </div>
</section>

<script>
  // Init after Liquid rendered slides are in the DOM
  (function(){
    var slides = document.getElementsByClassName("slides");
    if (!slides.length) return;

    var slideIndex = Math.floor(Math.random() * slides.length);
    showSlides(slideIndex);

    function plusSlides(n){ showSlides(slideIndex += n); }
    window.plusSlides = plusSlides; // expose for buttons

    function showSlides(n){
      if (n >= slides.length) slideIndex = 0;
      if (n < 0) slideIndex = slides.length - 1;
      for (var i = 0; i < slides.length; i++) slides[i].style.display = "none";
      slides[slideIndex].style.display = "block";
    }

    // optional: arrow keys
    document.addEventListener("keydown", function(e){
      if (e.key === "ArrowRight") plusSlides(1);
      if (e.key === "ArrowLeft")  plusSlides(-1);
    });
  })();
</script>
